---
import Layout from '../../layouts/Layout.astro';
import { EXPLORE } from '../../consts/explore';
import type { Product } from '../../models/product.model';
import Cake from '../../components/Cake.astro';
import Details from '../../components/Details.astro';
import RelatedProducts from '../../sections/RelatedProducts.astro';


export async function getStaticPaths() {
  return EXPLORE.map((p) => ({
    params: { slug: p.id },
    props: { selection: p }
  }));
}
const { selection } = Astro.props as { selection: Product };

const ProductView = {
  'bespoke-cakes': Cake,
}[selection.slug] ?? null;

const relatedProducts = EXPLORE.filter(products => products.id  !== selection.id)

---

<Layout title={selection.title} description={selection.description}>
  <section class="flex flex-col pt-30 p-4 justify-center items-center text-center text-white pb-20" style={{ background: selection.props.bg }}>
    <h1 class="text-5xl mx-2 px-6 font-bold">{selection.title}</h1>
    <img class="animate-slideIn" src={`${selection.img}.webp`} alt={selection.title} />

    <div class="p-4 rounded-xl space-y-6 text-black text-left w-full max-w-3xl">
      <div class="bg-white p-4 rounded-3xl shadow">
        <h2 class="text-2xl pb-3 font-bold">{selection.title}</h2>
        <div class="flex flex-row justify-between font-bold py-1">
          {selection.priceFrom && <p class="text-lg">From: {selection.priceFrom}â‚¬</p>}
          {selection.leadTimeDays && <p class="text-md">Lead time: {selection.leadTimeDays} days</p>}
        </div>
        <p class="text-xl text-left">{selection.description}</p>
      </div>
      <details class="  ">
        <summary class="inline-flex items-center bg-white  gap-2 rounded-full px-4 py-2 text-sm font-medium
           bg-violeta-oscuro text-black cursor-pointer shadow-md hover:bg-violeta-medio transition" >
                Order Now
        </summary>
        <form class=" p-2 group mt-2 rounded-2xl bg-white/80  shadow-xl border border-slate-100
          flex flex-col gap-2 z-20" >
          {ProductView ? <ProductView selection={selection} /> : null}        
         
          <div class="bg-white p-4 rounded-3xl shadow group">
          <label class="text-xl font-medium">Notes</label>
          <textarea
            name="notes"
            rows="2"
            placeholder="Ej: Mensaje en la tarta, alergias, etc."
            class="w-full rounded-xl border border-slate-200 px-3 py-2 text-xs
                   focus:outline-none focus:ring-2 focus:ring-violeta-medio resize-none"
          ></textarea>
          </div>

          <div class="flex gap-2 justify-end pt-2">
            <button type="reset"  class="text-xs px-3 py-2 rounded-full border border-slate-200 text-slate-500 hover:bg-slate-50" >
              Clean
            </button>
            <button type="submit" class="text-xs px-4 py-2 rounded-full bg-green-500 text-white font-semibold hover:bg-verde-medio shadow-sm" >
              Confirm
            </button>
          </div>
        </form>
      </details>
    </div>
  </section>
  <RelatedProducts selection={relatedProducts}  />

</Layout>
