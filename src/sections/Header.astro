<header class="fixed top-0 w-full text-white mx-auto z-50">
    <nav class="flex justify-between items-center py-2 px-6 m-6 max-w-[80%] rounded-full mx-auto text-sm">
        <div class="flex flex-row justify-start">
            <a href="/"> <img src="favicon.png" alt="Earth mama's kitchen" class="size-10"> </a>
        </div>
        <div class="flex flex-row justify-end">
      <a href="/order" class="inline-block">Items: <span id="cartCount">0</span></a>
        </div>
    </nav>
<header>

<style>
    nav {
        background: transparent;
        animation: header-blur-scroll 0.3s ease-in-out both;
        animation-timeline: scroll();
        animation-range: 0 250px;
        border-bottom: 1px solid transparent;
    }

    @keyframes header-blur-scroll {
        0% {
            background: transparent;
            backdrop-filter: blur(0px);
        }
        100% {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }
    }
</style>

<script type="module">

  import { itemCount } from '../utils/cart.js';

  const cartCountEl = document.getElementById('cartCount');

  function renderInitialCount() {
    try {
      cartCountEl.textContent = String(itemCount());
    } catch (e) {
      console.error('render cart count error', e);
    }
  }

  renderInitialCount();

  // Escucha eventos de actualización del carrito
  window.addEventListener('cart:update', (e) => {
    const cart = e.detail ?? { items: [] };
    const count = (cart.items || []).reduce((s, i) => s + (i.qty || 1), 0);
    cartCountEl.textContent = String(count);
  });

  // También escucha storage para cambios desde otras pestañas (fallback)
  window.addEventListener('storage', (ev) => {
    if (ev.key === 'kerubin_cart_v1') {
      renderInitialCount();
    }
  });
</script>